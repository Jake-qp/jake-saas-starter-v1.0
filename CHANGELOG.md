# Changelog

All notable changes to the SaaS Starter Kit V2 will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/).

## [Unreleased]

### Added
- Feature Flags (F001-008): PostHog feature flag management with `useFeatureFlag(key)` returning boolean (defaults to `false` when PostHog unconfigured), `useFeatureFlagWithPayload(key)` for JSON payloads, admin flag management UI at `/admin/flags` (list, create, toggle, delete) proxying PostHog REST API via Next.js API routes, `isSuperAdmin` field on users table, `adminQuery`/`adminMutation` wrappers enforcing super admin access, `POSTHOG_PERSONAL_API_KEY` server-only (never exposed to client)
- Onboarding System (F001-007): Multi-step onboarding wizard for new users at `/t/[teamSlug]/onboarding`. 3-step wizard (Profile, Team, Get Started) using existing `StepWizard` component. Progress tracked in database (`onboardingStatus` + `onboardingStep` on users table) — persists across sessions. Skip button on every step. Dashboard auto-redirects new users to onboarding; completed/skipped users go straight to dashboard. `lib/onboardingConfig.ts` for step definitions and status helpers. Team rename mutation (`teams.update`) added for workspace naming step.
- Notification System (F001-006): In-app notification bell with unread count badge, real-time notification list with mark-as-read, notification preferences page with per-type email/in-app toggles, `createNotification` internal mutation with preference-aware dispatch, 8 React Email templates (welcome, invite-sent, invite-accepted, subscription-changed, payment-failed, payment-received, approaching-limit, member-removed) with shared `EmailLayout` (brand header + footer), email preview dev route (`/dev/emails`), `buildNotificationMessage()` type-safe message builder, `lib/notificationTypes.ts` notification type registry with defaults.
- AI/LLM Integration (F001-005): Dual-streaming AI chat with Vercel AI SDK v6. Default pattern via Next.js API route (`/api/ai/chat`) on Vercel Edge, alternative Convex HTTP action documented. Shared Convex mutations (`convex/ai.ts`) for saving messages and tracking credits. AI chat page at `/t/[teamSlug]/ai` with `useChat` streaming, model selector (GPT-4o, GPT-4o-mini, Claude Sonnet, Claude Haiku), credit usage meter, and empty state. Full mutation pattern: authenticate → authorize ("Use AI" permission) → entitle (aiCredits) → rate limit (20/min) → execute. Credit tracking via `decrementCredits()` with calendar-month periods. `lib/aiModels.ts` shared model configuration.
- File Storage & Uploads (F001-017): `<FileUploader>` component with drag-drop zone, progress bars, and client+server-side type/size validation. `<AvatarUpload>` for user and team avatars with image preview and remove. `<FileAttachment>` / `<FileAttachmentList>` for inline image display and download links. Convex file storage backend (`convex/storage.ts`) with signed URL upload flow, avatar management (save/remove for users and teams), file deletion with storage cleanup, and team file listing. Shared validation config (`lib/fileConfig.ts`) as single source of truth for allowed types, size limits, and avatar constraints. `useFileUpload` hook for 3-step Convex upload flow with progress tracking. Storage quota enforcement via `checkEntitlement(ctx, teamId, "storageQuotaMB")` with per-tier limits (Free: 100MB, Pro: 1GB, Enterprise: unlimited). `files` table with team edge, purpose indexing, and uploader tracking. User/team `avatarStorageId` fields with old-avatar cleanup on replacement.
- Marketing Site & Legal Pages (F001-012): Landing page with hero, features grid, auto-populated pricing table (from `planConfig.ts`), FAQ accordion, and CTA sections. Standalone `/pricing` page. `/contact` form with Zod validation and Resend email integration (`/api/contact`). Legal pages (`/legal/terms`, `/legal/privacy`, `/legal/cookies`) rendered from MDX via `next-mdx-remote`. Distinct marketing layout with dedicated nav/footer. Shared content modules (`lib/marketing-content.ts`, `lib/contact-schema.ts`). `@tailwindcss/typography` for prose styling.
- Analytics & Event Tracking (F001-009): PostHog product analytics with env-var gated graceful degradation, `useTrack()` hook wrapping `posthog.capture()` (no-op when unconfigured), `useFeatureFlag()` for PostHog feature flags, PostHogProvider + PostHogPageView in root layout for manual App Router pageviews, PostHogIdentify for `posthog.identify()` + `posthog.group("team", teamId)`, PostHog server client for API routes (`posthog-node`), Convex-side event tracking via `@samhoque/convex-posthog`, reverse proxy at `/ph/*` (from F001-014)
- Polar Billing + Credits (F001-003): Team-level billing via `@convex-dev/polar` with three-tier plan system (Free/Pro/Enterprise), configurable entitlements in `lib/planConfig.ts`, `checkEntitlement()` enforcement with structured ConvexError on limit hit, credit-based AI billing with per-model costs and calendar-month periods, `decrementCredits()` for post-request tracking, Polar webhook integration (subscription created/updated), billing settings page with real-time usage meters and plan comparison, `CustomerPortalLink` and `CheckoutLink` integration
- Production Infrastructure (F001-014): Sentry error monitoring (client/server/edge) with env-var gated graceful degradation, tunnel route `/monitoring` for ad-blocker avoidance, Vercel Analytics + Speed Insights in root layout, PostHog reverse proxy (`/ph/*` rewrites), 4 Convex cron jobs (invite cleanup, credit reset, subscription sync, session cleanup), team-scoped rate limiting via `@convex-dev/rate-limiter`, preview seed data (`convex/seedPreview.ts`), deployment documentation (`docs/deployment.md`)
- Testing & Quality Infrastructure (F001-016): Vitest + convex-test for unit/integration tests, Playwright + axe-playwright for E2E and accessibility tests, GitHub Actions CI pipeline (type-check, lint, unit tests, E2E), Husky + lint-staged pre-commit hooks, seed test files for permissions/planConfig/auth/accessibility, tightened ESLint rules
- Design System Expansion (F001-002): 8 app-level components (PageHeader, DataTable, EmptyState, StatusBadge, PricingCard, UsageMeter, StepWizard, ThemeToggle), semantic color tokens enforced via ESLint, dark mode support
